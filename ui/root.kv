#:kivy 2.1.0
<RootWindow>:
    orientation: "horizontal"
    padding: dp(2)
    spacing: 0

    # Desktop layout (default)
    BoxLayout:
        id: desktop_layout
        orientation: "horizontal"
        spacing: dp(10)
        size_hint_x: 1 if not root.is_mobile else 0
        width: self.parent.width if not root.is_mobile else 0

        # Left side: settings and controls
        BoxLayout:
            orientation: "vertical"
            size_hint_x: None
            # Width = root width - square size (which is min(root width, root height))
            width: root.width - min(root.width, root.height)
            spacing: dp(2)

            ScrollView:
                do_scroll_x: False
                do_scroll_y: True

                BoxLayout:
                    id: controls_box
                    orientation: "vertical"
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: dp(10)

            BoxLayout:
                size_hint_y: None
                height: dp(50)
                spacing: dp(20)

                ActionButtons:
                    id: action_buttons

        # Right side: visualization
        FloatLayout:
            size_hint_x: None
            # Width and height both equal to min(root width, root height) to keep square aspect
            width: min(root.width, root.height)
            height: min(root.width, root.height)

            AspectRatioTextureWidget:
                id: square_widget
                size_hint: (1, 1)  # fill the entire FloatLayout
                pos: self.parent.pos  # align with parent's bottom-left
                size: self.parent.size  # fill parent exactly

# ---------------------------------------------------------------------------------------------- #

    # Mobile layout: everything stacked vertically
    BoxLayout:
        id: mobile_layout
        orientation: "vertical"
        spacing: dp(10)
        size_hint_x: 1 if root.is_mobile else 0
        width: self.parent.width if root.is_mobile else 0

        FloatLayout:
            size_hint_y: 0.6
            AspectRatioTextureWidget:
                id: square_widget_mobile
                size_hint: None, None
                size:
                    (min(self.parent.width, self.parent.height),
                    min(self.parent.width, self.parent.height))
                pos:
                    (self.parent.center_x - self.width / 2,
                    self.parent.center_y - self.height / 2)

        ScrollView:
            size_hint_y: 0.4
            do_scroll_x: False
            do_scroll_y: True

            BoxLayout:
                id: controls_box_mobile
                orientation: "vertical"
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(10)

                # Buttons below sliders for mobile
                BoxLayout:
                    size_hint_y: None
                    height: dp(50)
                    spacing: dp(20)

                    ActionButtons:
                        id: action_buttons
